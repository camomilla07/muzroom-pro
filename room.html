<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>MuzRoom — Комната</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="color-scheme" content="light dark">
  <style>
    :root { --gap:12px; --radius:10px; }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; height:100%; overflow-x:hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 16px; }
    h1 { margin: 0 0 10px; font-size: 20px; }
    .row { display:flex; flex-wrap:wrap; gap: var(--gap); align-items:center; }
    .card { border:1px solid #ddd; border-radius: var(--radius); padding:16px; }
    .muted { color:#666; font-size: 14px; }
    .hidden { display:none !important; }
    button, input[type="text"], input[type="url"] {
      font: inherit; font-size:16px; /* чтобы iOS не зумил */
    }
    button { padding: 10px 14px; border-radius: 8px; border:1px solid #ccc; background:#f6f6f6; cursor:pointer; }
    button:active { transform: translateY(1px); }
    input[readonly] { background: #fafafa; }
    .grid { display:grid; grid-template-columns: 1fr; gap: var(--gap); }
    @media (min-width: 800px) {
      .grid { grid-template-columns: 1.2fr 1fr; }
    }

    /* Блок ссылки ученика */
    #studentLinkWrap { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    #studentLink { flex:1 1 420px; min-width: 220px; padding:10px; border-radius:8px; border:1px solid #ccc; }

    /* Видео/превью */
    video, .videoBox { width:100%; max-height: 360px; background:#000; border-radius: var(--radius); }
    video[playsinline] { object-fit: cover; }
    .stat { display:flex; gap:8px; align-items:center; font-size:14px; color:#444; }

    /* Плеер, который «не съезжает» */
    .player { display:flex; align-items:center; gap:8px; width:100%; overflow:hidden; border:1px solid #e5e5e5; border-radius: var(--radius); padding:10px; }
    .player .title { flex:1 1 auto; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .player .time { flex:0 0 auto; font-variant-numeric: tabular-nums; font-size: 14px; }
    .player button { flex:0 0 auto; }
    .player input[type="range"] {
      -webkit-appearance:none; appearance:none;
      flex:0 0 200px; width:200px; height: 14px;
    }
    .player input[type="range"]::-webkit-slider-runnable-track { height:4px; }
    .player input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance:none; appearance:none;
      width:16px; height:16px; border-radius:50%;
      border:1px solid #aaa; background:#fff;
      margin-top:-6px; /* центрировать над треком */
    }
    @media (max-width:520px){
      .player { flex-wrap:wrap; }
      .player input[type="range"] { flex: 1 0 100%; width:100%; }
    }

    .warn { padding:10px; border-radius:8px; background:#fff4e5; border:1px solid #ffd19a; color:#7a4b00; }
    .ok { padding:10px; border-radius:8px; background:#e9fff0; border:1px solid #a9e7bf; color:#145c2c; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Комната MuzRoom</h1>
    <p class="muted">Открой как преподаватель — сгенерируется ссылка для ученика. Ученику достаточно открыть ссылку.</p>

    <div id="signalWarn" class="warn hidden">Сигналинг-сервер не найден. Подключение ученик↔преподаватель пока недоступно. (Это не ошибка сайта — просто нет WebSocket / Socket.IO на бэкенде.)</div>
    <div id="signalOk" class="ok hidden">Сигналинг подключён. Можно создавать звонок и подключаться по ссылке.</div>

    <div class="card grid">
      <section>
        <h2 style="margin-top:0">Ссылка для ученика</h2>
        <div id="studentLinkWrap">
          <input id="studentLink" type="url" readonly value="Пока нет ссылки" />
          <button id="copyBtn" type="button">Скопировать</button>
        </div>
        <p class="muted" id="roleHint"></p>

        <div style="height:8px"></div>
        <div class="row">
          <button id="allowBtn" type="button">Открыть доступ к микрофону/камере</button>
          <button id="startCallBtn" type="button" class="hidden">Начать звонок (преподаватель)</button>
        </div>

        <div style="height:8px"></div>
        <video id="localVideo" playsinline autoplay muted class="hidden"></video>
        <video id="remoteVideo" playsinline autoplay class="hidden"></video>
        <div id="avStat" class="stat hidden">Микрофон: <span id="micStat">—</span> • Камера: <span id="camStat">—</span></div>
      </section>

      <section>
        <h2 style="margin-top:0">Плейлист / аудио</h2>
        <div class="player" id="player">
          <button id="playPause" type="button">▶</button>
          <div class="title" id="trackTitle">Файл не выбран</div>
          <input id="seek" type="range" min="0" max="100" step="0.1" value="0" />
          <div class="time" id="time">0:00 / 0:00</div>
          <audio id="audio" preload="metadata"></audio>
        </div>
        <div style="height:8px"></div>
        <input id="file" type="file" accept="audio/*">
        <p class="muted">На iOS/Android автоплей запрещён — воспроизведение начнётся после нажатия.</p>
      </section>
    </div>
  </div>

  <!-- WebRTC совместимость -->
  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
  <!-- (необязательно) Socket.IO, если есть на сервере: -->
  <script src="/socket.io/socket.io.js" defer onerror="/* ок, просто нет socket.io */"></script>

  <!-- Твой основной JS -->
  <script src="./app.js"></script>
</body>
</html>
